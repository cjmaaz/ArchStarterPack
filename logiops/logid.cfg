// /etc/logid.cfg - MX Master 3S Configuration
// Last Updated: November 2025
// Device: Logitech MX Master 3S
// Purpose: Button remapping, gestures, and scroll wheel optimization
// 
// CID (Control ID) Mappings for MX Master 3S:
// Physical Button Location â†’ CID Code
// 0x52 = Middle click (scroll wheel button press)
// 0x53 = Back button (left side, below thumb rest)
// 0x56 = Forward button (left side, below back button)
// 0xc3 = Gesture button (thumb button with tactile feedback)
// 0xc4 = SmartShift button (top button near scroll wheel)
//
// How to find CID codes for your mouse:
// 1. Stop logid service: sudo systemctl stop logid
// 2. Run in debug mode: sudo logid -v
// 3. Press buttons and observe the CID codes in output
//
// See readme.md for detailed setup instructions

devices: (
{
    // Device name must match your mouse
    // Find with: sudo logid -v (look for device name in output)
    name: "MX Master 3S";

    // SmartShift: Automatic ratchet/free-spin switching
    // When scrolling fast, wheel becomes free-spinning for quick navigation
    // When scrolling slow, ratchet engages for precise control
    smartshift:
    {
        on: true;           // Enable SmartShift
        threshold: 30;      // Speed threshold for free-spin (lower = easier to trigger)
        torque: 50;         // Resistance in ratchet mode (higher = more tactile)
    };

    // High-resolution scroll wheel settings
    // Controls scroll speed and behavior
    hiresscroll:
    {
        hires: false;       // Use standard resolution (not hi-res ticks)
        invert: false;      // Normal scroll direction (false = natural scrolling)
        target: true;       // Send events to focused window
        up: {
            mode: "Axis";                   // Scroll mode
            axis: "REL_WHEEL";              // Vertical scroll axis
            axis_multiplier: 2.0;           // Scroll speed (2x faster)
        },
        down: {
            mode: "Axis";
            axis: "REL_WHEEL";
            axis_multiplier: -2.0;          // Negative for down direction
        }
    };

    // Mouse DPI (sensitivity)
    // Higher = faster cursor movement
    // Range: 200-8000 (typical: 800-2000 for desktop use)
    dpi = 2000;

    buttons: (
        // wheel middle
        {
            cid = 0x52;
            action =
            {
                type = "Mouse";
            };
        },

        // back
        {
            cid = 0x53;
            action =
            {
                type = "Mouse";
            };
        },

        // forward
        {
            cid = 0x56;
            action =
            {
                type = "Mouse";
            };
        },

        // mode shift button -> Toggle SmartShift (ratchet <-> free spin)
        {
            cid = 0xc4;
            action =
            {
                type = "Action";
                action =
                {
                    type = "ToggleSmartShift";
                };
            };
        },

        // gesture button (0xc3) - click = overview (Meta+W), hold+swipe = gestures
        {
            cid = 0xc3;
            action =
            {
                type = "Gestures";
                gestures = (
                    // click without movement -> Overview (Meta+W)
                    {
                        direction = "None";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_W");
                        };
                    },

                    // swipe left -> workspace left (Meta + Ctrl + Left)
                    {
                        direction = "Left";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_LEFTCTRL", "KEY_RIGHT");
                        };
                    },

                    // swipe right -> workspace right (Meta + Ctrl + Right)
                    {
                        direction = "Right";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_LEFTCTRL", "KEY_LEFT");
                        };
                    },

                    // swipe up -> task switcher (Meta + Tab)
                    {
                        direction = "Up";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_TAB");
                        };
                    },

                    // swipe down -> show desktop (Meta + D)
                    {
                        direction = "Down";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_D");
                        };
                    }
                );
            };
        }
    ); // end buttons

    thumbwheel:
    {
        divert: false; // Enable thumbwheel handling
        invert: true; // Invert the thumbwheel scroll direction
        left:
        {
            mode: "NoPress"; // Action when thumbwheel is scrolled left
        },
        right:
        {
            mode: "NoPress"; // Action when thumbwheel is scrolled right
        }
    };

    wheel =
    {
        vertical =
        {
            resolution = 15;
            invert = false;
        };
        horizontal =
        {
            resolution = 12;
            invert = false;
        };
    };

    thumb_wheel_id = 0x2150;
}
);
