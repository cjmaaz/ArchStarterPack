// /etc/logid.cfg - MX Master 3S - correct CID mapping
// 0x52 = scroll wheel button
// 0x53 = back
// 0x56 = forward
// 0xc3 = thumb gesture button (click + hold+swipe)
// 0xc4 = mode shift button (toggle SmartShift)

devices: (
{
    name: "MX Master 3S";

    smartshift:
    {
        on: true;
        threshold: 30;
        torque: 50;
    };

    hiresscroll:
    {
        hires: false;
        invert: false;
        target: true;
        up: {
            mode: "Axis";
            axis: "REL_WHEEL";
            axis_multiplier: 2.0;
        },
        down: {
            mode: "Axis";
            axis: "REL_WHEEL";
            axis_multiplier: -2.0;
        }
    };

    dpi = 2000;

    buttons: (
        // wheel middle
        {
            cid = 0x52;
            action =
            {
                type = "Mouse";
            };
        },

        // back
        {
            cid = 0x53;
            action =
            {
                type = "Mouse";
            };
        },

        // forward
        {
            cid = 0x56;
            action =
            {
                type = "Mouse";
            };
        },

        // mode shift button -> Toggle SmartShift (ratchet <-> free spin)
        {
            cid = 0xc4;
            action =
            {
                type = "Action";
                action =
                {
                    type = "ToggleSmartShift";
                };
            };
        },

        // gesture button (0xc3) - click = overview (Meta+W), hold+swipe = gestures
        {
            cid = 0xc3;
            action =
            {
                type = "Gestures";
                gestures = (
                    // click without movement -> Overview (Meta+W)
                    {
                        direction = "None";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_W");
                        };
                    },

                    // swipe left -> workspace left (Meta + Ctrl + Left)
                    {
                        direction = "Left";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_LEFTCTRL", "KEY_RIGHT");
                        };
                    },

                    // swipe right -> workspace right (Meta + Ctrl + Right)
                    {
                        direction = "Right";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_LEFTCTRL", "KEY_LEFT");
                        };
                    },

                    // swipe up -> task switcher (Meta + Tab)
                    {
                        direction = "Up";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_TAB");
                        };
                    },

                    // swipe down -> show desktop (Meta + D)
                    {
                        direction = "Down";
                        mode = "OnRelease";
                        action =
                        {
                            type = "Keypress";
                            keys = ("KEY_LEFTMETA", "KEY_D");
                        };
                    }
                );
            };
        }
    ); // end buttons

    thumbwheel:
    {
        divert: false; // Enable thumbwheel handling
        invert: true; // Invert the thumbwheel scroll direction
        left:
        {
            mode: "NoPress"; // Action when thumbwheel is scrolled left
        },
        right:
        {
            mode: "NoPress"; // Action when thumbwheel is scrolled right
        }
    };

    wheel =
    {
        vertical =
        {
            resolution = 15;
            invert = false;
        };
        horizontal =
        {
            resolution = 12;
            invert = false;
        };
    };

    thumb_wheel_id = 0x2150;
}
);
